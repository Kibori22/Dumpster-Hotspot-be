// A simple JavaScript object representing an item in the database
const itemSchema = {
  ownerId: "user_123",
  title: "Vintage Camera",
  description: "Perfect condition, looking for a tablet or high-end headphones.",
  categories: ["Electronics", "Photography"],
  status: "available", // available, pending_trade, traded
  lookingFor: ["Tablets", "Audio Gear"] // Tags to help the matching algorithm
};
/**
 * Finds direct barter matches between users.
 * @param {Object} item - The item the user is currently offering.
 * @param {Array} allItems - The global list of available items from other users.
 * @returns {Array} - An array of matching items.
 */
function findDirectMatches(item, allItems) {
  return allItems.filter(potentialMatch => {
    // 1. Ensure we aren't matching with our own item
    if (item.ownerId === potentialMatch.ownerId) return false;

    // 2. Check if the potential item is something we want
    const userWantsMatch = item.lookingFor.includes(potentialMatch.category);

    // 3. Check if the potential match owner wants what we have
    const matchOwnerWantsOurs = potentialMatch.lookingFor.includes(item.category);

    // Only return if both conditions are true (The "Double Coincidence")
    return userWantsMatch && matchOwnerWantsOurs;
  });
}

// --- Example Usage ---
const myItem = {
  id: "item_01",
  ownerId: "user_A",
  category: "Electronics",
  lookingFor: ["Furniture", "Books"]
};

const marketplace = [
  { id: "item_02", ownerId: "user_B", category: "Furniture", lookingFor: ["Electronics"] }, // Match!
  { id: "item_03", ownerId: "user_C", category: "Books", lookingFor: ["Clothing"] },      // No match
  { id: "item_04", ownerId: "user_D", category: "Furniture", lookingFor: ["Tools"] }       // No match
];

const matches = findDirectMatches(myItem, marketplace);
console.log("Potential Matches:", matches);
// This is the "Endpoint" the frontend would call
app.get('/api/matches/:itemId', (req, res) => {
    const itemId = req.params.itemId;
    
    // 1. Find the item the user is trading from the database
    const userItem = database.findItemById(itemId); 
    
    // 2. Get all other items
    const allItems = database.getAllAvailableItems();

    // 3. Run the algorithm we built
    const potentialMatches = findDirectMatches(userItem, allItems);

    // 4. Send the data back to the frontend
    res.json(potentialMatches); 
});
/**
 * Finds 3-way circular trade opportunities.
 * @param {Object} itemA - The starting item (User A's item).
 * @param {Array} marketplace - All items available for trade.
 * @returns {Array} - An array of "Trade Circles" found.
 */
function findCircularMatches(itemA, marketplace) {
  const circles = [];

  // Step 1: Find people who have what User A wants (User B)
  const potentialBs = marketplace.filter(itemB => 
    itemA.lookingFor.includes(itemB.category)
  );

  potentialBs.forEach(itemB => {
    // Step 2: Find people who have what User B wants (User C)
    const potentialCs = marketplace.filter(itemC => 
      itemB.lookingFor.includes(itemC.category)
    );

    potentialCs.forEach(itemC => {
      // Step 3: Check if User C wants what User A has (Closing the circle!)
      if (itemC.lookingFor.includes(itemA.category)) {
        circles.push({
          step1: `${itemA.ownerId} gives ${itemA.category} to ${itemC.ownerId}`,
          step2: `${itemB.ownerId} gives ${itemB.category} to ${itemA.ownerId}`,
          step3: `${itemC.ownerId} gives ${itemC.category} to ${itemB.ownerId}`,
          participants: [itemA.ownerId, itemB.ownerId, itemC.ownerId]
        });
      }
    });
  });

  return circles;
}

// --- Example Data ---
const myItem = { ownerId: "Alice", category: "Toaster", lookingFor: ["Plant"] };

const market = [
  { ownerId: "Bob", category: "Plant", lookingFor: ["Book"] },
  { ownerId: "Charlie", category: "Book", lookingFor: ["Toaster"] }
];

const results = findCircularMatches(myItem, market);
console.log("Found Trade Circle:", results);
