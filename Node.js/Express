// A simple JavaScript object representing an item in the database
const itemSchema = {
  ownerId: "user_123",
  title: "Vintage Camera",
  description: "Perfect condition, looking for a tablet or high-end headphones.",
  categories: ["Electronics", "Photography"],
  status: "available", // available, pending_trade, traded
  lookingFor: ["Tablets", "Audio Gear"] // Tags to help the matching algorithm
};
/**
 * Finds direct barter matches between users.
 * @param {Object} item - The item the user is currently offering.
 * @param {Array} allItems - The global list of available items from other users.
 * @returns {Array} - An array of matching items.
 */
function findDirectMatches(item, allItems) {
  return allItems.filter(potentialMatch => {
    // 1. Ensure we aren't matching with our own item
    if (item.ownerId === potentialMatch.ownerId) return false;

    // 2. Check if the potential item is something we want
    const userWantsMatch = item.lookingFor.includes(potentialMatch.category);

    // 3. Check if the potential match owner wants what we have
    const matchOwnerWantsOurs = potentialMatch.lookingFor.includes(item.category);

    // Only return if both conditions are true (The "Double Coincidence")
    return userWantsMatch && matchOwnerWantsOurs;
  });
}

// --- Example Usage ---
const myItem = {
  id: "item_01",
  ownerId: "user_A",
  category: "Electronics",
  lookingFor: ["Furniture", "Books"]
};

const marketplace = [
  { id: "item_02", ownerId: "user_B", category: "Furniture", lookingFor: ["Electronics"] }, // Match!
  { id: "item_03", ownerId: "user_C", category: "Books", lookingFor: ["Clothing"] },      // No match
  { id: "item_04", ownerId: "user_D", category: "Furniture", lookingFor: ["Tools"] }       // No match
];

const matches = findDirectMatches(myItem, marketplace);
console.log("Potential Matches:", matches);
// This is the "Endpoint" the frontend would call
app.get('/api/matches/:itemId', (req, res) => {
    const itemId = req.params.itemId;
    
    // 1. Find the item the user is trading from the database
    const userItem = database.findItemById(itemId); 
    
    // 2. Get all other items
    const allItems = database.getAllAvailableItems();

    // 3. Run the algorithm we built
    const potentialMatches = findDirectMatches(userItem, allItems);

    // 4. Send the data back to the frontend
    res.json(potentialMatches); 
});
/**
 * Finds 3-way circular trade opportunities.
 * @param {Object} itemA - The starting item (User A's item).
 * @param {Array} marketplace - All items available for trade.
 * @returns {Array} - An array of "Trade Circles" found.
 */
function findCircularMatches(itemA, marketplace) {
  const circles = [];

  // Step 1: Find people who have what User A wants (User B)
  const potentialBs = marketplace.filter(itemB => 
    itemA.lookingFor.includes(itemB.category)
  );

  potentialBs.forEach(itemB => {
    // Step 2: Find people who have what User B wants (User C)
    const potentialCs = marketplace.filter(itemC => 
      itemB.lookingFor.includes(itemC.category)
    );

    potentialCs.forEach(itemC => {
      // Step 3: Check if User C wants what User A has (Closing the circle!)
      if (itemC.lookingFor.includes(itemA.category)) {
        circles.push({
          step1: `${itemA.ownerId} gives ${itemA.category} to ${itemC.ownerId}`,
          step2: `${itemB.ownerId} gives ${itemB.category} to ${itemA.ownerId}`,
          step3: `${itemC.ownerId} gives ${itemC.category} to ${itemB.ownerId}`,
          participants: [itemA.ownerId, itemB.ownerId, itemC.ownerId]
        });
      }
    });
  });

  return circles;
}

// --- Example Data ---
const myItem = { ownerId: "Alice", category: "Toaster", lookingFor: ["Plant"] };

const market = [
  { ownerId: "Bob", category: "Plant", lookingFor: ["Book"] },
  { ownerId: "Charlie", category: "Book", lookingFor: ["Toaster"] }
];

const results = findCircularMatches(myItem, market);
console.log("Found Trade Circle:", results);
// collection: items
{
  id: "item_123",
  ownerId: "user_A",
  title: "Vintage Camera",
  description: "Perfect condition, looking for a tablet",
  category: "Electronics",
  status: "available", // available, pending, traded
  tags: ["camera", "photography"],
  lookingFor: ["tablet", "ipad"] // helps the matching engine
}
// collection: trades
{
  id: "trade_456",
  initiatorId: "user_A",
  receiverId: "user_B",
  offeredItems: ["item_123"],
  requestedItems: ["item_789"],
  status: "proposed", // proposed, accepted, rejected, completed
  createdAt: "2026-01-21T..."
}
import React, { useState } from 'react';

/**
 * AddItemForm
 * This component allows users to list an item they want to barter.
 */
const AddItemForm = () => {
  // Local state to manage form inputs
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    category: 'General',
    lookingFor: '', // This is key for the barter matching logic
  });

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((prev) => ({
      ...prev,
      [name]: value,
    }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    // Logic to send data to your backend (e.g., Firebase or Node.js)
    console.log('Item submitted to marketplace:', formData);
    alert('Item listed for trade!');
  };

  return (
    <div style={styles.container}>
      <h2>List an Item for Barter</h2>
      <form onSubmit={handleSubmit} style={styles.form}>
        <label>Item Title</label>
        <input 
          name="title" 
          placeholder="e.g., Acoustic Guitar" 
          onChange={handleChange} 
          required 
        />

        <label>Description</label>
        <textarea 
          name="description" 
          placeholder="Describe the condition and history..." 
          onChange={handleChange} 
        />

        <label>What are you looking for?</label>
        <input 
          name="lookingFor" 
          placeholder="e.g., Electric Keyboard or Power Tools" 
          onChange={handleChange} 
          required
        />

        <button type="submit" style={styles.button}>Post to Marketplace</button>
      </form>
    </div>
  );
};

// Simple inline styles for demonstration
const styles = {
  container: { maxWidth: '400px', margin: 'auto', padding: '20px', fontFamily: 'Arial' },
  form: { display: 'flex', flexDirection: 'column', gap: '10px' },
  button: { padding: '10px', backgroundColor: '#007bff', color: 'white', border: 'none', cursor: 'pointer' }
};

export default AddItemForm;
